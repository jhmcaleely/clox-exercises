var led = 25;

fun flash(count) {
    gpio_init(led);
    gpio_set_direction(led, true);

    var state = false;

    fun sleep() {
        for (var i = 0; i < count; i = i + 1) {
            sleep_ms(500);
            yield;
        }
    }
    var sleeper = make_routine(sleep, false);

    fun toggle() {
        for (var i = 0; i < count; i = i + 1) {
            state = !state;
            gpio_put(led, state);
            resume(sleeper);
            yield;
        }
    }

    var flasher = make_routine(toggle, false);

    while (true) {
        resume(flasher);
    }
}
